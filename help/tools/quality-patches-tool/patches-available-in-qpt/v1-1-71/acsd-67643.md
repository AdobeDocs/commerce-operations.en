---
title: "ACSD-67643: Duplicate entries created during scheduled updates in high-nested category environments"
description: Apply the ACSD-67643 patch to fix the Adobe Commerce issue where duplicate entries are created during scheduled updates in environments with a high number of nested categories.
feature: Catalog Management
role: Admin, Developer
type: Troubleshooting
---

# ACSD-67643: Duplicate entries created during scheduled updates in high-nested category environments

The ACSD-67643 patch fixes the issue where duplicate entries are created during scheduled updates in environments with a high number of nested categories. This patch is available when the [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.71 is installed. The patch ID is ACSD-67643. Please note that this issue is scheduled to be fixed in Adobe Commerce 2.4.9.

## Affected products and versions

**The patch is created for Adobe Commerce version:**

* Adobe Commerce (all deployment methods) 2.4.8-p1

**Compatible with Adobe Commerce versions:**

* Adobe Commerce (all deployment methods) 2.4.8 - 2.4.8-p2

>[!NOTE]
>
>The patch might become applicable to other versions with new [!DNL Quality Patches Tool] releases. To check if the patch is compatible with your Adobe Commerce version, update the `magento/quality-patches` package to the latest version and check the compatibility on the [[!DNL Quality Patches Tool]: Search for patches page](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html). Use the patch ID as a search keyword to locate the patch.

## Issue

Duplicate entries occur when creating scheduled updates for environments that have a large number of nested categories.

<u>Steps to reproduce</u>:

1. **Generate sample data:**
    Use a performance fixtures file (For example: `small.xml`) with modifications:
        **[!UICONTROL Categories]**: *2,500*
        **[!UICONTROL Products]**: *250,000*

1. Run the following command:

    ```bash
    bin/magento setup:performance:generate-fixtures var/performance-toolkit/profiles/ce/small.xml
    ```

1. After creating products and categories, ensure all categories are anchors by running:

    ```sql
    UPDATE catalog_category_entity_int SET value = 1 WHERE attribute_id = (SELECT attribute_id FROM eav_attribute WHERE attribute_code = 'is_anchor');
    ```

1. Run a full reindex.
1. Log into the backend and open the **[!UICONTROL Categories]** page.
1. Move *Category 2* to *Category 1* to increase tree nesting.
1. Go to the most nested category (For example: *Category 2.1.1*).
1. Create a **Scheduled Update** and save the category.

<u>Expected results</u>:

The category is saved successfully.

<u>Actual results</u>:

An *Error 500* occurs, and the following message shows in the logs:

```
    Magento\Framework\DB\Adapter\DuplicateException:
    SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '6-165' for key 'PRIMARY', 
    query was: INSERT INTO `temp_category_descendants_68a35aea273fc` (`category_id`, `descendant_id`)
    SELECT `ce`.`entity_id` AS `category_id`, `ce2`.`entity_id` AS `descendant_id`
    FROM `catalog_category_entity` AS `ce`
    INNER JOIN `catalog_category_entity` AS `ce2` ON ce2.path LIKE CONCAT(ce.path, '/%')
```

## Apply the patch

To apply individual patches, use the following links depending on your deployment method:

* Adobe Commerce or Magento Open Source on-premises: [[!DNL Quality Patches Tool] > Usage](/help/tools/quality-patches-tool/usage.md) in the [!DNL Quality Patches Tool] guide
* Adobe Commerce on cloud infrastructure: [Upgrades and Patches > Apply Patches](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html) in the Commerce on Cloud Infrastructure guide

## Related reading

To learn more about [!DNL Quality Patches Tool], refer to:

* [[!DNL Quality Patches Tool]: A self-service tool for quality patches](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) in the Tools guide
