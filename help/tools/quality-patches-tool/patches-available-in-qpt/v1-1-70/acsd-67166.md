---
title: "ACSD-67166: Duplicate execution of the `cataloginventory_stock_status` query when loading a quote on the storefront"
description: Apply the ACSD-67166 patch to fix the Adobe Commerce issue where duplicate execution of the `cataloginventory_stock_status` query occurs when loading a quote on the storefront, causing redundant DB calls.
feature: Inventory
role: Admin, Developer
type: Troubleshooting
---

# ACSD-67166: Duplicate execution of the `cataloginventory_stock_status` query when loading a quote on the storefront

The ACSD-67166 patch fixes the issue where duplicate execution of the `cataloginventory_stock_status` query occurs when loading a quote on the storefront, causing redundant DB calls. This patch is available when the [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70 is installed. The patch ID is ACSD-67166. Please note that this issue is scheduled to be fixed in Adobe Commerce 2.4.9.

## Affected products and versions

**The patch is created for Adobe Commerce version:**

* Adobe Commerce (all deployment methods) 2.4.5-p13

**Compatible with Adobe Commerce versions:**

* Adobe Commerce (all deployment methods) 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>The patch might become applicable to other versions with new [!DNL Quality Patches Tool] releases. To check if the patch is compatible with your Adobe Commerce version, update the `magento/quality-patches` package to the latest version and check the compatibility on the [[!DNL Quality Patches Tool]: Search for patches page](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html). Use the patch ID as a search keyword to locate the patch.

## Issue

Duplicate execution of the `cataloginventory_stock_status` query occurs when loading a quote on the storefront, causing redundant DB calls.

<u>Steps to reproduce</u>:

1. Install a clean instance.
1. Create a **[!UICONTROL Category]** and a **[!UICONTROL Simple Product]**.
1. Go to the category and add a product to the cart.
1. Go to the cart page: `/checkout/cart/`
1. Set breakpoints in [!DNL xDebug]:
    1. `app/code/Magento/CatalogInventory/Model/StockRegistryPreloader.php:115`
    1. `app/code/Magento/InventoryCatalog/Model/LegacyStockStatusCache.php:73`
    1. `lib/internal/Magento/Framework/Data/AbstractSearchResult.php:233`
    1. **Breakpoint Condition**: `strpos($this->query->getSelectSql(true), 'stock_status') !==false`
    Add `$_SERVER['REQUEST_URI']` to *watches* in [!DNL PHPStorm] to verify the query is called twice within the same request.

<u>Expected results</u>:

The query is executed once per request.

<u>Actual results</u>:

The same query is executed twice:

```
SELECT `main_table`.*, `cp_table`.`sku`, `cp_table`.`type_id` FROM `cataloginventory_stock_status` AS `main_table`
 INNER JOIN `catalog_product_entity` AS `cp_table` ON main_table.product_id = cp_table.entity_id AND (cp_table.created_in <= 1 AND cp_table.updated_in > 1) WHERE (`main_table`.`product_id` IN(2)) AND (`main_table`.`website_id` = '0') 
```

## Apply the patch

To apply individual patches, use the following links depending on your deployment method:

* Adobe Commerce or Magento Open Source on-premises: [[!DNL Quality Patches Tool] > Usage](/help/tools/quality-patches-tool/usage.md) in the [!DNL Quality Patches Tool] guide
* Adobe Commerce on cloud infrastructure: [Upgrades and Patches > Apply Patches](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html) in the Commerce on Cloud Infrastructure guide

## Related reading

To learn more about [!DNL Quality Patches Tool], refer to:

* [[!DNL Quality Patches Tool]: A self-service tool for quality patches](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) in the Tools guide
